<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Playbook de Resposta a Incidentes</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 30px;
            background-color: #f5f5f5;
            color: #333;
        }
        .container {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1, h2, h3 {
            color: #2c3e50;
        }
        section {
            margin-bottom: 32px;
        }
        .section-title {
            border-left: 5px solid #3498db;
            padding-left: 12px;
            margin-bottom: 12px;
            font-size: 1.4em;
        }
        ul, ol {
            margin-left: 24px;
        }
        .subsection-title {
            color: #2980b9;
            margin-top: 18px;
            font-size: 1.1em;
        }
        .code-block {
            background: #f8f8f8;
            border-radius: 5px;
            padding: 10px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            margin: 6px 0 12px 0;
            white-space: pre-wrap;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin-bottom: 16px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
        }
        th {
            background-color: #f0f4f8;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Playbook de Resposta a Incidentes</h1>

        <section>
            <div class="section-title">Contexto do Subgrafo</div>
            <div>The subgraph highlights the Credential Access Technique hierarchy, specifically the Brute Force technique (T1110) and its sub-techniques, as well as related concepts such as SSH, firewall, and user authentication. This context informs the playbook’s focus on SSH brute‑force detection, mitigation, and prevention.</div>
        </section>

        <section>
            <div class="section-title">Resumo do Incidente</div>
            <ul>
                <li><b>Visão Geral:</b> On 2025-07-10 at 10:30 UTC, the firewall logged 15 failed SSH login attempts from 192.168.1.100 targeting user 'admin' on host 10.0.0.1 within a 5‑minute window, indicating a brute‑force credential‑guessing attack.</li>
                <li><b>Classificação Técnica:</b> Credential Access – Brute Force (T1110)</li>
                <li><b>Avaliação de Severidade:</b> High – The attack targets privileged accounts, potentially leading to unauthorized system access and lateral movement.</li>
                <li><b>Impacto Potencial:</b> Compromise of the admin account could allow full system control, data exfiltration, persistence, and further attacks across the network.</li>
            </ul>
        </section>

        <section>
            <div class="section-title">Etapas de Investigação</div>
            <div class="subsection-title">Etapas de Triagem</div>
            <div>1. Verify the alert source and timestamp.
2. Confirm the affected host and port.
3. Check for additional anomalous authentication events.
4. Correlate with other logs (system, application, network).</div>

            <div class="subsection-title">Coleta de Evidências</div>
            <table>
                <tr><th>Descrição</th><th>Comando</th></tr>
                <tr><td>Collect recent authentication logs from the SSH daemon.</td><td><span class="code-block">grep -i "Failed password" /var/log/auth.log | tail -n 200 > /tmp/auth_failures.log</span></td></tr><tr><td>Capture current SSH configuration for audit.</td><td><span class="code-block">cat /etc/ssh/sshd_config > /tmp/sshd_config_backup</span></td></tr><tr><td>Snapshot the shadow file to verify credential integrity.</td><td><span class="code-block">cp /etc/shadow /tmp/shadow_snapshot</span></td></tr><tr><td>Export firewall rules for forensic preservation.</td><td><span class="code-block">iptables-save > /tmp/iptables_rules.bak</span></td></tr>
            </table>

            <div class="subsection-title">Análise Técnica</div>
            <div>Analyze the authentication logs for patterns (e.g., repeated usernames, timing). Verify SSH settings (PermitRootLogin, MaxAuthTries). Check for any unusual network connections on port 22. Use auditd to monitor subsequent login attempts. Correlate with external threat intel for the source IP.</div>

            <div class="subsection-title">Ferramentas e Comandos</div>
            <table>
                <tr><th>Ferramenta</th><th>Uso</th><th>Exemplo</th></tr>
                <tr><td>fail2ban</td><td>Automated banning of IPs after repeated failures.</td><td><span class="code-block">fail2ban-client set sshd bantime 86400</span></td></tr><tr><td>auditd</td><td>Real‑time monitoring of authentication events.</td><td><span class="code-block">auditctl -w /var/log/auth.log -p wa</span></td></tr><tr><td>ss</td><td>Inspect active SSH connections.</td><td><span class="code-block">ss -tuln | grep :22</span></td></tr><tr><td>grep</td><td>Search logs for failed attempts.</td><td><span class="code-block">grep -i "Failed password" /var/log/auth.log</span></td></tr><tr><td>md5sum</td><td>Verify integrity of critical files.</td><td><span class="code-block">md5sum /etc/shadow</span></td></tr>
            </table>

            <div class="subsection-title">Indicadores de Comprometimento</div>
            <ul>
                <li>Source IP: 192.168.1.100</li><li>Destination IP: 10.0.0.1</li><li>Port: 22</li><li>User: admin</li><li>15 failed login attempts within 5 minutes</li><li>Repeated 'Failed password' entries in /var/log/auth.log</li>
            </ul>
        </section>

        <section>
            <div class="section-title">Procedimentos de Contenção</div>
            <ul>
                <li><b>Ações Imediatas:</b> Immediately block the offending IP using the firewall: iptables -A INPUT -s 192.168.1.100 -j DROP.</li>
                <li><b>Isolamento do Sistema:</b> If the host is part of a critical subnet, isolate it by disabling its network interface or placing it in a quarantine VLAN.</li>
                <li><b>Bloqueio de Atividades Maliciosas:</b> Configure fail2ban to ban the IP for 24 hours and set MaxAuthTries to 3 in /etc/ssh/sshd_config. Restart sshd after changes.</li>
                <li><b>Preservação de Evidências:</b> Before making any configuration changes, copy all relevant logs and configuration files to a secure, write‑protected storage. Use immutable logging (e.g., rsyslog with disk‑based journaling).</li>
            </ul>
        </section>

        <section>
            <div class="section-title">Etapas de Erradicação</div>
            <ul>
                <li><b>Remoção da Ameaça:</b> Remove any malicious cron jobs or scheduled tasks that may have been created by the attacker. Verify /etc/cron.* and /var/spool/cron for unknown entries.</li>
                <li><b>Correção de Vulnerabilidades:</b> Ensure SSH is patched to the latest version, enforce key‑based authentication, disable root login, and set a strong MaxAuthTries limit. Apply any pending OS security updates.</li>
                <li><b>Verificação de Movimento Lateral:</b> Run a host‑based intrusion detection scan (e.g., chkrootkit, rkhunter) and review network logs for unusual outbound connections. Verify that no backdoors or remote shells remain.</li>
            </ul>
        </section>

        <section>
            <div class="section-title">Procedimentos de Recuperação</div>
            <ul>
                <li><b>Restauração do Sistema:</b> Restore the host from the latest clean backup if the integrity of critical files is compromised. Otherwise, re‑install the OS and re‑apply configuration from the backup snapshot.</li>
                <li><b>Validação de Integridade:</b> Recalculate checksums of /etc/shadow, /etc/ssh/sshd_config, and other critical binaries. Compare against known good values from the backup or vendor signatures.</li>
                <li><b>Retorno às Operações:</b> After validation, re‑enable the host in the network, remove the firewall block on the IP, and monitor for any repeat attempts. Document the incident and update the incident log.</li>
            </ul>
        </section>

        <section>
            <div class="section-title">Lições Aprendidas & Prevenção</div>
            <ul>
                <li><b>Recomendações Preventivas:</b> Implement rate‑limiting on SSH, enforce MFA for privileged accounts, and deploy a centralized SIEM rule to detect rapid failed logins. Use YARA rules to flag suspicious SSH binaries.</li>
                <li><b>Melhorias de Segurança:</b> Enable auditd for all authentication events, enforce strict SSH hardening (PermitRootLogin no, PasswordAuthentication no), and regularly rotate SSH keys. Conduct quarterly penetration tests focusing on credential access.</li>
                <li><b>Atualizações de Políticas:</b> Update the incident response policy to include mandatory fail2ban configuration for all SSH servers, define a 24‑hour ban policy for brute‑force attempts, and require two‑factor authentication for admin accounts.</li>
            </ul>
        </section>
    </div>
</body>
</html>
