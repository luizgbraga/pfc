<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Playbook de Resposta a Incidentes</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 30px;
            background-color: #f5f5f5;
            color: #333;
        }
        .container {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1, h2, h3 {
            color: #2c3e50;
        }
        section {
            margin-bottom: 32px;
        }
        .section-title {
            border-left: 5px solid #3498db;
            padding-left: 12px;
            margin-bottom: 12px;
            font-size: 1.4em;
        }
        ul, ol {
            margin-left: 24px;
        }
        .subsection-title {
            color: #2980b9;
            margin-top: 18px;
            font-size: 1.1em;
        }
        .code-block {
            background: #f8f8f8;
            border-radius: 5px;
            padding: 2px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            margin: 6px 0 12px 0;
            white-space: pre-wrap;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin-bottom: 16px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
        }
        th {
            background-color: #f0f4f8;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Playbook de Resposta a Incidentes</h1>

        <section>
            <div class="section-title">Contexto do Subgrafo</div>
            <div>O subgrafo contém entidades fundamentais da ontologia DEFEND: User, NetworkTraffic, Process, FileSystem e CredentialAccessTechnique. O incidente envolve acesso não autorizado a um sistema via Telnet (NetworkTraffic), uso de credenciais padrão (CredentialAccessTechnique), execução de comandos maliciosos (Process) e manipulação de arquivos no sistema de arquivos (FileSystem).</div>
        </section>

        <section>
            <div class="section-title">Resumo do Incidente</div>
            <ul>
                <li><b>Visão Geral:</b> Um atacante externo (177.75.222.254) se conectou ao sistema via Telnet (porta 23), realizou um ataque de força bruta com credenciais padrão e logou com sucesso como 'ubnt/ubnt'. Após o login, executou comandos para explorar o sistema, incluindo a execução de '/bin/busybox VSEPU', um binário malicioso associado a botnets IoT como Mirai. O atacante tentou baixar e executar payloads via tftp/wget e manipulou arquivos em /dev/shm, indicando intenção de persistência e propagação.</li>
                <li><b>Classificação Técnica:</b> Credential Access Technique (T1110) seguido por Command and Control (T1071) e Execution (T1059.003) com foco em IoT comprometido via binário malicioso (VSEPU).</li>
                <li><b>Avaliação de Severidade:</b> Alta. O sistema foi comprometido por credenciais padrão em um dispositivo IoT exposto à internet, com execução de binário malicioso (VSEPU) associado a botnets. O atacante demonstrou capacidade de persistência, execução de código e potencial para propagação lateral em redes IoT.</li>
                <li><b>Impacto Potencial:</b> Comprometimento de dispositivo IoT, uso como vetor de ataque para propagação em rede interna, participação em DDoS, exfiltração de dados de rede, e possível infecção de outros dispositivos com credenciais padrão. Risco de violação de conformidade e interrupção de serviços críticos.</li>
            </ul>
        </section>

        <section>
            <div class="section-title">Etapas de Investigação</div>
            <div class="subsection-title">Etapas de Triagem</div>
            <div>Verificar logs de acesso Telnet em todos os sensores Cowrie, identificar sessões com login bem-sucedido e comandos suspeitos. Focar em sessões com uso de 'busybox VSEPU', 'tftp', 'wget' ou escrita em /dev/shm. Correlacionar IPs de origem com listas de reputação de ameaças (ex: AbuseIPDB).</div>

            <div class="subsection-title">Coleta de Evidências</div>
            <table>
                <tr><th>Descrição</th><th>Comando</th></tr>
                <tr><td>Extrair todos os logs de sessão do sensor Cowrie para análise forense.</td><td><span class="code-block">grep -E '"eventid":"cowrie.session.(connect|login|closed)"' /var/log/cowrie/cowrie.* > /evidence/cowrie_sessions.</span></td></tr><tr><td>Coletar comandos executados durante a sessão comprometida (d3dbb59041fb).</td><td><span class="code-block">grep '"session":"d3dbb59041fb"' /var/log/cowrie/cowrie.* | grep '"eventid":"cowrie.command.input"' > /evidence/compromised_commands.txt</span></td></tr><tr><td>Exportar metadados do sistema afetado (se acessível) para análise de artefatos em disco.</td><td><span class="code-block">find /dev/shm -type f -name "*.s" -exec ls -la {} \; > /evidence/dev_shm_artifacts.txt</span></td></tr>
            </table>

            <div class="subsection-title">Análise Técnica</div>
            <div>Analisar o binário 'VSEPU' como payload de botnet IoT. Verificar se é uma variante do Mirai ou similar, com base em hashes e strings. Investigar se o sistema afetado é um roteador ou câmera IoT com firmware vulnerável. Verificar se o IP 177.75.222.254 está associado a outras tentativas de login em outros sensores. Analisar padrões de comandos: 'cat .s || cp /bin/echo .s' sugere tentativa de criar um arquivo de payload, e 'dd bs=52 count=1 if=.s' indica leitura binária para exfiltração ou execução.</div>

            <div class="subsection-title">Ferramentas e Comandos</div>
            <table>
                <tr><th>Ferramenta</th><th>Uso</th><th>Exemplo</th></tr>
                <tr><td>strings</td><td>Extrair strings de binários suspeitos para identificar C2 domains ou IPs.</td><td><span class="code-block">strings /evidence/VSEPU_binary | grep -E '[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}'</span></td></tr><tr><td>sha256sum</td><td>Calcular hash SHA256 do binário VSEPU para busca em VT ou MISP.</td><td><span class="code-block">sha256sum /evidence/VSEPU_binary</span></td></tr><tr><td>grep</td><td>Buscar por padrões de comandos maliciosos em logs.</td><td><span class="code-block">grep -i 'busybox.*VSEPU' /var/log/cowrie/cowrie.*</span></td></tr>
            </table>

            <div class="subsection-title">Indicadores de Comprometimento</div>
            <ul>
                <li>177.75.222.254</li><li>ubnt/ubnt</li><li>/bin/busybox VSEPU</li><li>cd /dev/shm; cat .s || cp /bin/echo .s</li><li>tftp; wget; /bin/busybox VSEPU</li><li>dd bs=52 count=1 if=.s</li>
            </ul>
        </section>

        <section>
            <div class="section-title">Procedimentos de Contenção</div>
            <ul>
                <li><b>Ações Imediatas:</b> Desativar imediatamente o serviço Telnet no dispositivo afetado. Bloquear o IP 177.75.222.254 em todos os firewalls de borda e sensores de rede. Desativar o acesso SSH/Telnet de internet para todos os dispositivos IoT.</li>
                <li><b>Isolamento do Sistema:</b> Isolar o dispositivo afetado da rede interna: desconectá-lo fisicamente ou aplicar regra de firewall para bloquear todo tráfego de entrada e saída. Comando: iptables -A OUTPUT -d 172.29.0.2 -j DROP && iptables -A INPUT -s 172.29.0.2 -j DROP</li>
                <li><b>Bloqueio de Atividades Maliciosas:</b> Bloquear no firewall de rede: IP 177.75.222.254, domínios associados a VSEPU (ex: mirai-c2[.]com), e portas 23/Telnet e 69/TFTP. Comandos: iptables -A INPUT -s 177.75.222.254 -j DROP && iptables -A OUTPUT -p udp --dport 69 -j DROP</li>
                <li><b>Preservação de Evidências:</b> Copiar todos os logs do sensor Cowrie para armazenamento imutável: cp /var/log/cowrie/cowrie.* /evidence/backup/ && chmod 444 /evidence/backup/* && sha256sum /evidence/backup/* > /evidence/backup/checksums.sha256</li>
            </ul>
        </section>

        <section>
            <div class="section-title">Etapas de Erradicação</div>
            <ul>
                <li><b>Remoção da Ameaça:</b> Remover o binário VSEPU e arquivos suspeitos em /dev/shm: find /dev/shm -name "*.s" -delete && rm -f /tmp/VSEPU /tmp/busybox 2>/dev/null. Verificar processos em execução: ps aux | grep -i "VSEPU" && kill -9 <PID> se encontrado.</li>
                <li><b>Correção de Vulnerabilidades:</b> Atualizar firmware do dispositivo IoT afetado com versão oficial e segura. Alterar todas as credenciais padrão (ubnt/ubnt, root/root, admin/admin) em todos os dispositivos IoT da rede. Desativar serviços desnecessários como Telnet e TFTP.</li>
                <li><b>Verificação de Movimento Lateral:</b> Verificar logs de outros sensores Cowrie para tentativas de login com as mesmas credenciais (ubnt/ubnt) em outros IPs. Buscar por conexões de saída suspeitas do dispositivo afetado: netstat -anp | grep ESTABLISHED | grep -v "127.0.0.1". Verificar se o IP 177.75.222.254 tentou acessar outros dispositivos na rede interna.</li>
            </ul>
        </section>

        <section>
            <div class="section-title">Procedimentos de Recuperação</div>
            <ul>
                <li><b>Restauração do Sistema:</b> Restaurar o dispositivo afetado a partir de backup limpo ou reinstalar firmware oficial. Nunca restaurar de imagem comprometida. Aplicar configuração segura: desativar Telnet, habilitar SSH com chave, bloquear portas desnecessárias.</li>
                <li><b>Validação de Integridade:</b> Validar integridade do firmware com hash conhecido: sha256sum /firmware.bin && compare com hash oficial do fabricante. Verificar ausência de arquivos suspeitos: find / -type f -name "*.s" -o -name "VSEPU" -o -name "busybox" 2>/dev/null | grep -v "/proc".</li>
                <li><b>Retorno às Operações:</b> Retornar à operação somente após: (1) firmware atualizado e verificado, (2) credenciais alteradas, (3) regras de firewall aplicadas, (4) nenhum processo suspeito em execução, e (5) monitoramento contínuo por 48h sem atividade anormal.</li>
            </ul>
        </section>

        <section>
            <div class="section-title">Lições Aprendidas & Prevenção</div>
            <ul>
                <li><b>Recomendações Preventivas:</b> Criar regra SIEM: alerta se 'busybox VSEPU' ou 'cd /dev/shm; cat .s' for detectado em logs de Telnet. Criar regra YARA para binários VSEPU: rule mirai_vsepu { strings: $a = "VSEPU" ascii condition: all of them }.</li>
                <li><b>Melhorias de Segurança:</b> Implementar hardening: desativar Telnet em todos os dispositivos IoT, usar SSH com autenticação por chave, bloquear portas 23 e 69 em firewalls de borda, aplicar segmentação de rede para dispositivos IoT. Habilitar EDR em todos os dispositivos Linux IoT que suportem.</li>
                <li><b>Atualizações de Políticas:</b> Atualizar política de acesso: proibir expor serviços de administração (Telnet, FTP, SSH) à internet. Exigir mudança de credenciais padrão em todos os dispositivos IoT no momento da instalação. Implementar revisão trimestral de dispositivos expostos e relatórios de vulnerabilidades.</li>
            </ul>
        </section>
    </div>
</body>
</html>
